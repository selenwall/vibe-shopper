<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Shopping Vibes</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div class="app-container">
      <header class="app-header">
        <h1>Shopping Vibes</h1>
        <div class="header-actions">
          <span id="item-count" class="item-count" aria-live="polite">0 items</span>
          <button id="clear-all" class="ghost" type="button" title="Clear all items">Clear all</button>
        </div>
      </header>

      <form id="add-form" class="add-form" autocomplete="off">
        <div class="row">
          <input
            id="item-input"
            type="text"
            placeholder="Add an item"
            aria-label="Item"
            required
            autofocus
          />
          <button type="submit">Add</button>
        </div>
      </form>

      <ul id="items" class="items"></ul>
    </div>

    <script>
      (function initializeSimpleListApp() {
        const formElement = document.getElementById('add-form');
        const inputElement = document.getElementById('item-input');
        const itemsListElement = document.getElementById('items');
        const itemCountElement = document.getElementById('item-count');
        const clearAllButton = document.getElementById('clear-all');

        let draggedElement = null;

        function getItemElements() {
          return Array.from(itemsListElement.querySelectorAll('li.item'));
        }

        function updateCountAndEmptyState() {
          const items = getItemElements();
          const count = items.length;
          itemCountElement.textContent = count === 1 ? '1 item' : count + ' items';

          let emptyState = itemsListElement.querySelector('li.empty-state');
          if (count === 0) {
            if (!emptyState) {
              emptyState = document.createElement('li');
              emptyState.className = 'empty-state';
              emptyState.textContent = 'Your list is empty. Add your first item!';
              itemsListElement.appendChild(emptyState);
            }
          } else if (emptyState) {
            emptyState.remove();
          }
        }

        function createItemElement(itemName) {
          const listItemElement = document.createElement('li');
          listItemElement.className = 'item enter';
          listItemElement.innerHTML = `
            <button class="drag-handle" type="button" title="Drag to reorder" aria-label="Drag handle" data-handle>‚†ø</button>
            <span class="text"></span>
            <input class="edit-input" type="text" aria-label="Edit item" />
            <div class="actions">
              <button class="icon-btn edit" type="button" data-action="edit" title="Edit" aria-label="Edit">‚úèÔ∏è</button>
              <button class="icon-btn save" type="button" data-action="save" title="Save" aria-label="Save">‚úî</button>
              <button class="icon-btn cancel" type="button" data-action="cancel" title="Cancel" aria-label="Cancel">‚úñ</button>
              <button class="icon-btn delete" type="button" data-action="delete" title="Remove" aria-label="Remove">üóëÔ∏è</button>
            </div>
          `;

          const textSpan = listItemElement.querySelector('.text');
          const editInput = listItemElement.querySelector('.edit-input');
          textSpan.textContent = itemName;
          editInput.value = itemName;

          const handle = listItemElement.querySelector('[data-handle]');
          handle.addEventListener('pointerdown', function onHandlePointerDown() {
            listItemElement.setAttribute('draggable', 'true');
          });
          listItemElement.addEventListener('dragend', function onDragEnd() {
            listItemElement.removeAttribute('draggable');
          });

          editInput.addEventListener('keydown', function onEditKeyDown(event) {
            if (event.key === 'Enter') {
              saveEdit(listItemElement);
            } else if (event.key === 'Escape') {
              cancelEdit(listItemElement);
            }
          });

          textSpan.addEventListener('dblclick', function onDoubleClick() {
            enterEdit(listItemElement);
          });

          return listItemElement;
        }

        function appendItemToList(itemName) {
          const listItemElement = createItemElement(itemName);
          itemsListElement.appendChild(listItemElement);
          requestAnimationFrame(() => listItemElement.classList.remove('enter'));
          updateCountAndEmptyState();
        }

        function enterEdit(listItemElement) {
          const input = listItemElement.querySelector('.edit-input');
          const textEl = listItemElement.querySelector('.text');
          input.value = textEl.textContent;
          listItemElement.classList.add('editing');
          input.focus();
          input.select();
        }

        function saveEdit(listItemElement) {
          const input = listItemElement.querySelector('.edit-input');
          const newValue = (input.value || '').trim();
          if (!newValue) {
            cancelEdit(listItemElement);
            return;
          }
          listItemElement.querySelector('.text').textContent = newValue;
          listItemElement.classList.remove('editing');
        }

        function cancelEdit(listItemElement) {
          const text = listItemElement.querySelector('.text').textContent;
          listItemElement.querySelector('.edit-input').value = text;
          listItemElement.classList.remove('editing');
        }

        // Form submit
        formElement.addEventListener('submit', function onFormSubmit(event) {
          event.preventDefault();
          const trimmedValue = (inputElement.value || '').trim();
          if (!trimmedValue) return;
          appendItemToList(trimmedValue);
          inputElement.value = '';
          inputElement.focus();
        });

        // Delegated clicks for actions
        itemsListElement.addEventListener('click', function onListClick(event) {
          const button = event.target.closest('button');
          if (!button) return;
          const listItemElement = button.closest('li.item');
          const action = button.dataset.action;
          if (!listItemElement || !action) return;

          if (action === 'edit') {
            enterEdit(listItemElement);
          } else if (action === 'save') {
            saveEdit(listItemElement);
          } else if (action === 'cancel') {
            cancelEdit(listItemElement);
          } else if (action === 'delete') {
            listItemElement.remove();
            updateCountAndEmptyState();
          }
        });

        // Drag and drop
        itemsListElement.addEventListener('dragstart', function onDragStart(event) {
          const listItemElement = event.target.closest('li.item');
          if (!listItemElement) return;
          draggedElement = listItemElement;
          listItemElement.classList.add('dragging');
          if (event.dataTransfer) {
            event.dataTransfer.effectAllowed = 'move';
            event.dataTransfer.setData('text/plain', '');
          }
        });

        itemsListElement.addEventListener('dragover', function onDragOver(event) {
          if (!draggedElement) return;
          event.preventDefault();
          const targetLi = event.target.closest('li.item');
          if (!targetLi || targetLi === draggedElement) return;
          const rect = targetLi.getBoundingClientRect();
          const isBefore = event.clientY < rect.top + rect.height / 2;
          if (isBefore) {
            itemsListElement.insertBefore(draggedElement, targetLi);
          } else {
            itemsListElement.insertBefore(draggedElement, targetLi.nextSibling);
          }
        });

        itemsListElement.addEventListener('drop', function onDrop(event) {
          if (!draggedElement) return;
          event.preventDefault();
          draggedElement.classList.remove('dragging');
          draggedElement = null;
        });

        itemsListElement.addEventListener('dragend', function onDragEndList() {
          if (draggedElement) {
            draggedElement.classList.remove('dragging');
            draggedElement = null;
          }
        });

        // Clear all
        clearAllButton.addEventListener('click', function onClearAll() {
          getItemElements().forEach((el) => el.remove());
          updateCountAndEmptyState();
          inputElement.focus();
        });

        // Initialize
        updateCountAndEmptyState();
      })();
    </script>
  </body>
</html>